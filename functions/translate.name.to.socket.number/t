;==========================================================================================================================================================================================================================================================================================================================
;
;   translate.name.to.socket.number
;
;   This function translates a given name to a connected socket number.
;
;   Assumptions:    edx = Length of given name.
;                   esi = Pointer to a given name.
;
;   Returns:        eax - pointer to socket associated with the given name, or error.
;

    translate.name.to.socket.number:              push  esi                                           ; Preserve caller's esi.
                                                  push  edi                                           ; Preserve caller's edi.
                                                  push  ecx                                           ; Preserve caller's ecx.

                                                  mov   edi, connection.table+connection.pname.index  ; edi - Pointer to socket name.
                                                  mov   ecx, socket.number                            ; ecx - Number of total sockets for loop counter.

    translate.name.to.socket.number.search.loop:  push  ecx                                           ; Preserve loop counter.

                                                  push  esi                                           ; Preserve pointer to given name.
                                                  push  edi                                           ; Preserve pointer to socket name.

                                                  mov   ecx, edx                                      ; ecx - Length of given name.

                                                  repnz cmpsb                                         ; Is this socket occupied by the participant referenced by the given name?

                                                  pop   edi                                           ; Restore pointer to socket name.
                                                  pop   esi                                           ; Restore pointer to given name.

                                                  jcxz  translate.name.to.socket.number.found.socket  ; If the comparison was good, go set up eax for our return.

                                                  pop   ecx                                           ; Restore loop counter.

                                                  add   edi, connection.entry.size                    ; edi - Pointer to next socket name.
                                                  loop  translate.name.to.socket.number.search.loop   ; Go check the next socket.

                                                  mov   eax, 0FFFFh                                   ; eax - Error indicator.

    translate.name.to.socket.number.cleanup:      pop   ecx                                           ; Restore caller's ecx.
                                                  pop   edi                                           ; Restore caller's edi.
                                                  pop   esi                                           ; Restore caller's esi.

                                                  ret                                                 ; Return to caller

    translate.name.to.socket.number.found.socket: pop   ecx                                           ; Restore caller's ecx.

                                                  mov   eax, edi                                      ; eax - Pointer to socket name.
                                                  sub   eax, connection.pname.index                   ; eax - Pointer to referenced socket.
                                                  jmp   translate.name.to.socket.number.cleanup       ; Go cleanup after ourselves and return to caller.
                                                  
